{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://meeting-transcriber.local/template.schema.json",
  "title": "Analysis Template",
  "description": "Schema for Meeting Transcriber analysis templates",
  "type": "object",
  "required": ["name", "description", "icon", "category", "outputs", "sections"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Display name of the template"
    },
    "description": {
      "type": "string",
      "minLength": 1,
      "maxLength": 500,
      "description": "Brief description of the template's purpose"
    },
    "icon": {
      "type": "string",
      "minLength": 1,
      "description": "Lucide icon name for visual representation"
    },
    "category": {
      "type": "string",
      "enum": ["meeting", "interview", "review"],
      "description": "Template category for organization"
    },
    "outputs": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": [
          "summary",
          "benchmarks",
          "radio_reports",
          "safety_events",
          "action_items",
          "quotes",
          "decisions"
        ]
      },
      "description": "Types of outputs this template generates"
    },
    "sections": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/section"
      },
      "description": "Array of sections to extract from transcripts"
    },
    "maxStrategy": {
      "type": "string",
      "enum": ["basic", "hybrid", "advanced"],
      "description": "Maximum analysis strategy allowed for this template. Radio traffic templates should use 'basic' or 'hybrid' to avoid truncation issues with advanced cascading."
    },
    "contentType": {
      "type": "string",
      "enum": ["meeting", "radio-traffic", "interview", "general"],
      "description": "Type of content this template is designed for. Affects default strategy selection."
    }
  },
  "definitions": {
    "section": {
      "type": "object",
      "required": ["id", "name", "prompt", "extractEvidence", "outputFormat"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique identifier for the section (lowercase, hyphens allowed)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Display name for the section"
        },
        "prompt": {
          "type": "string",
          "minLength": 10,
          "description": "AI prompt used to extract this section's content from the transcript"
        },
        "extractEvidence": {
          "type": "boolean",
          "description": "Whether to include timestamp citations as evidence"
        },
        "outputFormat": {
          "type": "string",
          "enum": ["bullet_points", "paragraph", "table"],
          "description": "How to format the extracted content"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "description": "Optional array of section IDs this section depends on"
        }
      }
    }
  }
}
